<apex:page controller="GameFightDBController">
    <apex:form>
        <apex:actionFunction name="startGame" action="{!initGameUnits}"/>

        <apex:pageBlock title="Game parameters" id="game_parameters">
            <apex:commandButton value="Get random system unit" onClick="" action="{!initGameUnits}"
                                reRender="SystemUnit, UserUnit, ChosenUnit, Results"/>
        </apex:pageBlock>
    </apex:form>

    <apex:outputPanel id="SystemUnit">
        <apex:form>
            <apex:pageBlock title="System unit" id="system_units" rendered="{!isShowSystemUnit}">
                <apex:pageBlockSection columns="4" title="You will fight with system unit:">
                    <apex:outputField value="{!systemUnit.Name}" label="Name:"/>
                    <apex:outputField value="{!systemUnit.HealthPoint__c}" label="Health Points:"/>
                    <apex:outputField value="{!systemUnit.DamageMin__c}" label="DamageMin:"/>
                    <apex:outputField value="{!systemUnit.DamageMax__c}" label="DamageMax:"/>
                </apex:pageBlockSection>
            </apex:pageBlock>
        </apex:form>
    </apex:outputPanel>

    <apex:outputPanel id="UserUnit">
        <apex:form>
            <apex:actionFunction name="selectUserUnitFromList" action="{!chooseUnit}"
                                 rerender="ChosenUnit, UserUnit, ErrorUnit, GameStart"/>

            <apex:actionFunction name="saveNewUserUnit" action="{!saveNewUnit}"/>

            <apex:actionFunction name="checkNewUserUnitFilling" action="{!checkNewUnit}"
                                 rerender="ChosenUnit, ErrorUnit, GameStart, SaveButton"/>

            <apex:pageBlock title="User unit" id="user_units" rendered="{!isShowUserUnit}">
                <apex:pageBlockSection columns="5" title="Please choose your unit or create your own unit">
                    <apex:selectList value="{!userChoice}" id="userUnitSelectList" styleclass="std" size="1"
                                     onChange="selectUserUnitFromList()" onSelect="selectUserUnitFromList()">
                        <apex:selectOptions value="{!userUnitSelectList}"/>
                    </apex:selectList>

                    <apex:inputField value="{!newUserUnit.Name}" label="Name:"
                                     onkeyup="{checkNewUserUnitFilling()}"/>
                    <apex:inputField value="{!newUserUnit.HealthPoint__c}" label="Health Points:"
                                     onkeyup="{checkNewUserUnitFilling()}"/>
                    <apex:inputField value="{!newUserUnit.DamageMin__c}" label="DamageMin:"
                                     onkeyup="{checkNewUserUnitFilling()}"/>
                    <apex:inputField value="{!newUserUnit.DamageMax__c}" label="DamageMax:"
                                     onkeyup="{checkNewUserUnitFilling()}"/>
                    <apex:commandButton id="SaveButton" value="Save new unit" onClick="saveNewUserUnit()"
                                        disabled="{!isNewUserSaveDisabled}"
                                        rerender="ChosenUnit, UserUnit, ErrorUnit, GameStart"/>
                </apex:pageBlockSection>
            </apex:pageBlock>
        </apex:form>
    </apex:outputPanel>

    <apex:outputPanel id="ErrorUnit">
        <apex:form>
            <apex:pageBlock title="Error!" id="error_unit" rendered="{!isShowMessage}">
                <apex:outputText value="{!errorMessage}"/>
            </apex:pageBlock>
        </apex:form>
    </apex:outputPanel>

    <apex:outputPanel id="ChosenUnit">
        <apex:form>
            <apex:pageBlock title="User's chosen unit" id="chosen_unit" rendered="{!isShowUserChosenUnit}">
                <!--<apex:outputText value="{!userChoice}" title="userChose: "/>-->
                <apex:pageBlockSection columns="1" title="Your chosen unit is:"
                >
                    <apex:outputField value="{!userUnit.Name}" label="Name:"/>
                    <apex:outputField value="{!userUnit.HealthPoint__c}" label="Health Points:"/>
                    <apex:outputField value="{!userUnit.DamageMin__c}" label="DamageMin:"/>
                    <apex:outputField value="{!userUnit.DamageMax__c}" label="DamageMax:"/>
                </apex:pageBlockSection>

            </apex:pageBlock>
            <apex:pageBlock title="Game start" id="GameStart" rendered="{!isShowGameStart}">
                <apex:commandButton action="{!fightButton}" value="Auto Fight" rerender="UserUnit, Results, ChosenUnit"/>
                <apex:commandButton action="{!fightButton}" value="Step by step Fight" rerender="UserUnit, Results, ChosenUnit"/>
            </apex:pageBlock>

        </apex:form>
    </apex:outputPanel>


    <apex:outputPanel id="Results">
        <apex:form>
            <apex:pageBlock title="Game result" id="game_results" rendered="{!isShowResult}">
                <apex:dataList value="{!gamelog}" var="gamelog">
                    <apex:outputText value="{!gamelog}"/>
                </apex:dataList>
                Winner:
                <apex:outputText value="{!winner.Name}"/>
            </apex:pageBlock>
        </apex:form>
    </apex:outputPanel>

</apex:page>